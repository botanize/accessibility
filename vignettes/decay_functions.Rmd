---
title: 'Decay functions'
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
urlcolor: blue
vignette: >
  %\VignetteIndexEntry{Decay functions} 
  %\VignetteEngine{knitr::rmarkdown} 
  \usepackage[utf8]{inputenc}
bibliography: references.json
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# 1. Introduction

Some functions of the `accessibility` package use decay functions to continuously discount the weight of opportunities as travel costs become larger. For convenience, the package currently includes the following decay functions (details in section 2). Additionally, the package also allows users to pass any custom decay function that converts travel cost `t_ij` to and impedance factor (see section 3).

# 2. Currently available decay functions

## 2.1 Binary decay function

Binary (aka step) function commonly used in cumulative opportunity measures.

$$
  \text{Cumulative Opportunities Rectangular: } &f(t_{ij})= \left\{
      \begin{array}{ll}
          1 & \quad \text{for }t_{ij} \leq \bar{t} \\
          0 & \quad \text{otherwise}
      \end{array}
    \right.\\
$$

```{r, include = FALSE}
library(accessibility)
library(data.table)
library(ggplot2)

vec <- 0:100
decay_value <- 0.2
cutoff <- 50

step        <- decay_binary(cutoff=cutoff)
linear      <- decay_linear(cutoff=cutoff)
exponential <- decay_exponential(decay_value=decay_value)
power       <- decay_power(decay_value = decay_value)

df <- data.table(
  minutes = vec,
  binary =          step(vec),
  linear =          linear(vec),
  exponential =     exponential(vec),
  inverse_power =   power(vec)
)

df2 <- data.table::melt.data.table(data = df, id.vars = 'minutes', variable.name = 'decay_function', value.name = 'impedance_factor')

ggplot() +
  geom_line(data=df2, aes(x=minutes, y=impedance_factor, color=decay_function), show.legend = FALSE) +
  facet_wrap(.~decay_function, ncol = 2) +
  theme_minimal()

```

# 3. Using a custom decay function

Let's use the sample data available in the `accessibility` package o demonstrante how you could use a custom decay function. Let's load the data first.

```{r, message=FALSE, warning=FALSE}

# load input data
data_path <- system.file("extdata/ttm_bho.rds", package = "accessibility")
ttm <- readRDS(data_path)
head(ttm)

```


custom_decay_fun = function(z){}




```{r, message = FALSE, eval = FALSE}
grav_exp <- gravity_access(
              data = ttm,
              opportunity_col = 'jobs',
              decay_function = decay_exponential(decay_value = 0.2),
              travel_cost_col = 'travel_time',
              by_col = 'from_id'
              )

head(grav_exp)





